<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MapHub GeoJSON - MapHub Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../index.html">Introduction</a></li><li class="chapter-item affix "><li class="part-title">Guide</li><li class="chapter-item "><a href="../../map_provider_keys/index.html">Map provider keys</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../map_provider_keys/mapbox/mapbox.html">Mapbox</a></li><li class="chapter-item "><a href="../../map_provider_keys/here/here.html">HERE Maps</a></li><li class="chapter-item "><a href="../../map_provider_keys/esri/esri.html">ESRI</a></li><li class="chapter-item "><a href="../../map_provider_keys/thunderforest/thunderforest.html">Thunderforest</a></li></ol></li><li class="chapter-item "><a href="../../import_export/index.html">Import and Export</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../import_export/xlsx_csv_import/index.html">XLSX / CSV import</a></li></ol></li><li class="chapter-item "><a href="../../api/index.html">API</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../api/index.html">Introduction, API key</a></li><li class="chapter-item "><a href="../../api/map_list.html">List maps</a></li><li class="chapter-item "><a href="../../api/map_get.html">Get map</a></li><li class="chapter-item "><a href="../../api/map_upload.html">Upload map</a></li><li class="chapter-item "><a href="../../api/map_update.html">Update map</a></li><li class="chapter-item "><a href="../../api/map_append.html">Append map</a></li><li class="chapter-item "><a href="../../api/map_refresh_image.html">Refresh map image</a></li><li class="chapter-item "><a href="../../api/image_upload.html">Upload image</a></li><li class="chapter-item "><a href="../../api/marker_upload.html">Upload marker</a></li></ol></li><li class="chapter-item "><li class="part-title">Tutorials</li><li class="chapter-item "><a href="../../tutorials/addresses_to_coordinates/index.html">Converting addresses to lat-lon coordinates</a></li><li class="chapter-item expanded "><a href="../../tutorials/api_map_from_table/1_introduction.html">API: Map from a table</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorials/api_map_from_table/1_introduction.html">Introduction</a></li><li class="chapter-item "><a href="../../tutorials/api_map_from_table/2_empty_map.html">Create a new map</a></li><li class="chapter-item "><a href="../../tutorials/api_map_from_table/3_images.html">Upload images and markers</a></li><li class="chapter-item expanded "><a href="../../tutorials/api_map_from_table/4_geojson.html" class="active">MapHub GeoJSON</a></li><li class="chapter-item "><a href="../../tutorials/api_map_from_table/5_update.html">Update map</a></li><li class="chapter-item "><a href="../../tutorials/api_map_from_table/6_refresh_image.html">Refresh image</a></li></ol></li><li class="chapter-item "><a href="../../tutorials/first_map/tutorial.html">Creating your first map</a></li><li class="chapter-item "><a href="../../tutorials/wix_embed/index.html">Embed on Wix.com</a></li><li class="chapter-item "><a href="../../tutorials/drawing_tools/tutorial.html">Drawing tools</a></li><li class="chapter-item "><a href="../../tutorials/geocode_google_earth/index.html">Geocoding using Google Earth</a></li><li class="chapter-item affix "><li class="part-title">Old</li><li class="chapter-item "><a href="../../import_export/csv_import/index.html">CSV import</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MapHub Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="step-4-make-the-geojson"><a class="header" href="#step-4-make-the-geojson">Step 4: Make the GeoJSON</a></h2>
<p>In this step, we'll generate a GeoJSON from the CSV table data. Later we call the <a href="../../api/map_update.html">Update map</a> endpoint with the generated GeoJSON.</p>
<h4 id="geojson-on-maphub"><a class="header" href="#geojson-on-maphub">GeoJSON on MapHub</a></h4>
<p>Every map on MapHub is stored as a GeoJSON document. All map data: points, polygons, etc. are stored in this single document. To understand the structure of a MapHub map, the best thing is to download a map you've created as GeoJSON.</p>
<p>You can do this by opening one of your maps on MapHub.net and clicking on the &quot;Download&quot; button in the right side panel and then selecting &quot;MapHub GeoJSON&quot;.</p>
<p>For example, the finished map of this tutorial has the following GeoJSON:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;FeatureCollection&quot;,
  &quot;features&quot;: [
    {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;id&quot;: 515312282,
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [-0.128018, 51.519294]
      },
      &quot;properties&quot;: {
        &quot;title&quot;: &quot;British Museum&quot;,
        &quot;description&quot;: &quot;The world-famous British Museum exhibits the works of man from prehistoric to modern times, from around the world. Highlights include the Rosetta Stone, the Parthenon sculptures and the mummies in the Ancient Egypt collection.&quot;,
        &quot;url&quot;: &quot;https://www.britishmuseum.org/&quot;,
        &quot;marker-symbol&quot;: &quot;museum&quot;,
        &quot;image&quot;: {
          &quot;id&quot;: &quot;pwasvdaus75tnn3w&quot;,
          &quot;w&quot;: 640,
          &quot;h&quot;: 360,
          &quot;tip_color&quot;: &quot;#bdbbcb&quot;,
          &quot;avg_color&quot;: &quot;#8895aa&quot;
        }
      }
    },
    {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;id&quot;: 521910492,
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [-0.128374, 51.508884]
      },
      &quot;properties&quot;: {
        &quot;title&quot;: &quot;National Gallery&quot;,
        &quot;description&quot;: &quot;The crowning glory of Trafalgar Square, London's National Gallery is a vast space filled with western European paintings from the 13th to the 19th centuries. Find works by masters such as Van Gogh, da Vinci, Botticelli, Constable, Renoir, Titian and Stubbs.&quot;,
        &quot;marker-symbol&quot;: &quot;star&quot;,
        &quot;image&quot;: {
          &quot;id&quot;: &quot;pr1xhpavd1atxs5l&quot;,
          &quot;w&quot;: 640,
          &quot;h&quot;: 360,
          &quot;tip_color&quot;: &quot;#8d857b&quot;,
          &quot;avg_color&quot;: &quot;#8c8c8e&quot;
        }
      }
    },
    {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;id&quot;: 1233836134,
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [-0.099342, 51.507429]
      },
      &quot;properties&quot;: {
        &quot;title&quot;: &quot;Tate Modern&quot;,
        &quot;description&quot;: &quot;Sitting grandly on the banks of the Thames is Tate Modern, Britain's national museum of modern and contemporary art. Its unique shape is due to it previously being a power station. The gallery's restaurants offer fabulous views across the city.&quot;,
        &quot;url&quot;: &quot;https://www.tate.org.uk/visit/tate-modern&quot;,
        &quot;marker-symbol&quot;: &quot;museum&quot;,
        &quot;image&quot;: {
          &quot;id&quot;: &quot;yibgsqadfifyaste&quot;,
          &quot;w&quot;: 640,
          &quot;h&quot;: 360,
          &quot;tip_color&quot;: &quot;#8493ab&quot;,
          &quot;avg_color&quot;: &quot;#9c9ea1&quot;
        }
      }
    },
    {
      &quot;type&quot;: &quot;Feature&quot;,
      &quot;id&quot;: 3383498660,
      &quot;geometry&quot;: {
        &quot;type&quot;: &quot;Point&quot;,
        &quot;coordinates&quot;: [-0.171637, 51.496884]
      },
      &quot;properties&quot;: {
        &quot;title&quot;: &quot;Victoria and Albert Museum&quot;,
        &quot;description&quot;: &quot;The V&amp;A celebrates art and design with 3,000 years' worth of amazing artefacts from around the world. A real treasure trove of goodies, you never know what you'll discover next: furniture, paintings, sculpture, metalwork and textiles; the list goes on.&quot;,
        &quot;url&quot;: &quot;https://www.vam.ac.uk/&quot;,
        &quot;marker_id&quot;: &quot;bvd5ykfilp7ekxyh&quot;,
        &quot;image&quot;: {
          &quot;id&quot;: &quot;ikxqpaqycbrpannw&quot;,
          &quot;w&quot;: 640,
          &quot;h&quot;: 360,
          &quot;tip_color&quot;: &quot;#d1b896&quot;,
          &quot;avg_color&quot;: &quot;#725d42&quot;
        }
      }
    }
  ],
  &quot;groups&quot;: []
}
</code></pre>
<p><em>Note: Some keys like <code>markers</code>, <code>properties</code> and <code>export</code> are not displayed here, as they are not important for this tutorial.</em></p>
<p><em>The <code>id</code> fields are optional, you can leave them out and they'll be automatically created.</em></p>
<h4 id="creating-the-geojson-from-the-table-data"><a class="header" href="#creating-the-geojson-from-the-table-data">Creating the GeoJSON from the table data</a></h4>
<p>The following function is the core of this tutorial, it creates a GeoJSON from the table data we have. It also reads information from the image and marker JSONs and inserts it into the GeoJSON.</p>
<pre><code class="language-python">def create_geojson_from_csv(csv_file):
    assert csv_file.is_file()

    features = []

    with open(csv_file, newline='') as f:
        # auto-detect the CSV dialect
        dialect = csv.Sniffer().sniff(f.read())
        f.seek(0)

        # use DictReader which gives a dict for each row
        reader = csv.DictReader(f, dialect=dialect)

        # for each row in the CSV file
        for row in reader:
            row = dict(row)

            lat = float(row['latitude'])
            lon = float(row['longitude'])

            # basic properties
            properties = {
                &quot;title&quot;: row['title'],
                &quot;description&quot;: row['description'],
                &quot;url&quot;: row['url'],
            }

            # if we have an icon from the default set, use it
            if row['icon_default']:
                properties['marker-symbol'] = row['icon_default']

            # if we have a custom icon, use the uploaded marker
            if row['icon_custom']:
                marker_info = get_image_marker_info('marker', row['icon_custom'])
                if marker_info:
                    properties['marker_id'] = marker_info['marker_id']

            # if we have an image, use the uploaded image
            if row['image']:
                image_info = get_image_marker_info('image', row['image'])
                if image_info:
                    properties['image'] = {
                        'id': image_info['image_id'],
                        'w': image_info['width'],
                        'h': image_info['height'],
                        'tip_color': image_info['tip_color'],
                        'avg_color': image_info['avg_color'],
                    }

            # create the GeoJSON for the item
            feature = {
                &quot;type&quot;: &quot;Feature&quot;,
                &quot;geometry&quot;: {&quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [lon, lat]},
                &quot;properties&quot;: properties,
            }
            features.append(feature)

    geojson = {
        &quot;type&quot;: &quot;FeatureCollection&quot;,
        &quot;features&quot;: features,
    }

    return geojson
</code></pre>
<p>The core of <code>get_image_marker_info</code> helper function:</p>
<pre><code class="language-python">def get_image_marker_info(kind, file_name):
    assert kind in {'image', 'marker'}

    if kind == 'image':
        file_path = IMAGES_DIR / file_name
    else:
        file_path = MARKERS_DIR / file_name

    info_json = file_path.parent / f'{file_path.stem}.json'

    with open(info_json) as f:
        return json.load(f)
</code></pre>
<p>In the next step, we will call the <a href="../../api/map_update.html">Update map</a> endpoint with the generated GeoJSON.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../tutorials/api_map_from_table/3_images.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../tutorials/api_map_from_table/5_update.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../tutorials/api_map_from_table/3_images.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../tutorials/api_map_from_table/5_update.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
